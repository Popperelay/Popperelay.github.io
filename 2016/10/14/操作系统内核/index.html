<!DOCTYPE HTML>
<html>

<head>
	<link rel="bookmark"  type="image/x-icon"  href="/img/logo_miccall.png"/>
	 <link rel="shortcut icon" href="/img/logo_miccall.png">
	
			
    <title>
    Elays'Blog
    </title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="/css/mic_main.css" />
    <link rel="stylesheet" href="/css/dropdownMenu.css" />
    
    	<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>
	
    <noscript>
        <link rel="stylesheet" href="/css/noscript.css" />
    </noscript>

			    <script src="/js/jquery.min.js"></script>
    <script src="/js/jquery.scrollex.min.js"></script>
    <script src="/js/jquery.scrolly.min.js"></script>
    <script src="/js/skel.min.js"></script>
    <script src="/js/util.js"></script>
    <script src="/js/main.js"></script>
	
<link rel="stylesheet" href="/css/prism-dark.css" type="text/css">
<link rel="stylesheet" href="/css/prism-line-numbers.css" type="text/css"></head>
    
		
<!-- Layouts -->


<!-- mathjax config similar to math.stackexchange -->

<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
    tex2jax: {
      inlineMath: [ ['$','$'], ["\\(","\\)"] ],
      processEscapes: true
    }
  });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Config({
      tex2jax: {
        skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
      }
    });
</script>

<script type="text/x-mathjax-config">
    MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for(i=0; i < all.length; i += 1) {
            all[i].SourceElement().parentNode.className += ' has-jax';
        }
    });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML">
</script>


<!--  代码渲染  -->
<link rel="stylesheet" href="/css/prism_undefined.css" />
<link rel="stylesheet" href="/css/typo.css" />
<!-- 文章页 -->
<body class="is-loading">
    <!-- Wrapper 外包 s-->
    <div id="wrapper" class="fade-in">
        <!-- Intro 头部显示 s -->
        <!-- Intro 头部显示 e -->
        <!-- Header 头部logo start -->
        <header id="header">
    <a href="/" class="logo">MICCALL</a>
</header>
        <!-- Nav 导航条 start -->
        <nav id="nav" class="special" >
            <ul class="menu links" >
			<!-- Homepage  主页  --> 
			<li >
	            <a href="/" rel="nofollow">主页</a>
	        </li>
			<!-- categories_name  分类   --> 
	        
	        <li class="active">
	            <a href="#s1">分类</a>
	                    <ul class="submenu">
	                        <li>
	                        <a class="category-link" href="/categories/Boost/">Boost</a></li><li><a class="category-link" href="/categories/C-语法/">C#语法</a></li><li><a class="category-link" href="/categories/C/">C++</a></li><li><a class="category-link" href="/categories/C语言/">C语言</a></li><li><a class="category-link" href="/categories/OpenGL/">OpenGL</a></li><li><a class="category-link" href="/categories/c/">c++</a></li><li><a class="category-link" href="/categories/全局光照/">全局光照</a></li><li><a class="category-link" href="/categories/博客配置/">博客配置</a></li><li><a class="category-link" href="/categories/并行计算/">并行计算</a></li><li><a class="category-link" href="/categories/操作系统/">操作系统</a></li><li><a class="category-link" href="/categories/数据结构/">数据结构</a></li><li><a class="category-link" href="/categories/毕设/">毕设</a></li><li><a class="category-link" href="/categories/游戏开发/">游戏开发</a></li><li><a class="category-link" href="/categories/游戏设计模式/">游戏设计模式</a></li><li><a class="category-link" href="/categories/计算机图形学/">计算机图形学</a></li><li><a class="category-link" href="/categories/设计模式/">设计模式</a></li><li><a class="category-link" href="/categories/调试错误集锦/">调试错误集锦</a>
	                    </ul>
	        </li>
	        
	        <!-- archives  归档   --> 
	        
	        
		        <!-- Pages 自定义   -->
		        
		        <li>
		            <a href="/about/" title="简历">
		                简历
		            </a>
		        </li>
		        
		        <li>
		            <a href="/group/" title="团队">
		                团队
		            </a>
		        </li>
		        
		        <li>
		            <a href="/gallery/" title="图库">
		                图库
		            </a>
		        </li>
		        
		        <li>
		            <a href="/tag/" title="标签">
		                标签
		            </a>
		        </li>
		        


            </ul>
            <!-- icons 图标   -->
			<ul class="icons">
		            
		                <li><a href="https://github.com/miccall" class="icon fa-github"><span class="label">GitHub</span></a></li>
		            
		            
		            
		            
			</ul>
</nav>

        <div id="main" >
            <div class ="post_page_title_img" style="height: 25rem;background-image: url(undefined);background-position: center; background-repeat:no-repeat; background-size:cover;-moz-background-size:cover;overflow:hidden;" >
                <a href="#" style="padding: 4rem 4rem 2rem 4rem ;"><h2 >操作系统内核（中断、时钟管理、系统调用）</h2></a>
            </div>
            <!-- Post -->
            <div class="typo" style="padding: 3rem;">
                <p>操作系统内核是指大多数操作系统的核心部分，是把一些执行频率高的模块常驻内存，它是计算机硬件的第一次扩充。<br><a id="more"></a><br>操作系统内核一般包括下述功能：</p>
<ul>
<li>支撑功能。包括中断处理、时钟管理、原语操作（也叫原子操作，是一组在执行过程中不能被中断的操作）等。</li>
<li>资源管理功能。包括进程管理、存储器管理、设备管理等。</li>
</ul>
<hr>
<p><font size="5" color="orange">中断</font></p>
<p><font size="4" color="red">中断是什么？</font><br>中断时改变处理器指令执行顺序的一种事件。该事件与CPU芯片内外部硬件电路产生的电信号相对应。<br>计算机在执行程序的过程中，若出现中断，计算机将停止现行程序的运行，转向对这些中断事件的处理，处理结束后返回被中断处，继续向下执行。</p>
<p><font size="4" color="red">为何需要中断？</font><br>引入中断机制前，当在CPU上执行的程序遇到I/O时，CPU采取反复轮询的方式检测本次I/O是否结束，在轮询的过程中CPU不能完成任何更有效的工作，这是对CPU相当大的浪费。引入中断机制后，一个正在执行的进程p1请求I/O后，CPU启动这次的I/O，然后CPU可以先去执行其他进程（而不用去轮询I/O是否结束），当I/O完成后，通过中断机制使CPU获得进程I/O结束的信息，转中断处理，处理完毕后返回到原来进程p1断点处，继续向后执行。<br>可以看到，在p1进程的I/O过程中，CPU不用去轮询I/O是否结束，而可以转去并行执行其他的进程，这无疑很大程度上减少了CPU的浪费。</p>
<p><font size="4" color="red">中断类型</font><br>中断分为同步中断（也叫内部中断或异常）和异步中断（也叫外部中断）。</p>
<p><font size="4" color="red">同步中断（（程序）内部中断或异常）</font><br>同步中断是当指令执行时由CPU控制单元产生的。之所以称为同步中断，是因为只有在一条<strong>指令终止执行后</strong>CPU才会发出中断，如除法错误、调试、溢出、浮点出错等。</p>
<p><font size="4" color="red">异步中断（外部中断）</font><br>异步中断是由其他硬件设备<strong>依照CPU时钟信号</strong>随机产生的。<br>外部中断又可以分为外部可屏蔽中断和外部不可屏蔽中断。</p>
<ul>
<li>外部可屏蔽中断。这种中断是由I/O设备产生的。有两种方式可以屏蔽中断：一时在Intel80X86的CPU上，把EFLAGS寄存器的IF标志置0，表示关中断，此时CPU忽略所有可屏蔽中断；二是通过对PIC编程来禁止IRQ，即可以告诉PIC停止对给定的IRQ线发布中断。</li>
<li>外部不可屏蔽中断。这种中断是由紧急事件引起的，如硬件故障。</li>
</ul>
<p><font size="4" color="red"> 引起中断的原因有哪些呢？</font></p>
<ul>
<li>人为设置中断。在程序中认为设置中断。</li>
<li>程序性事故。如计算中出现除数为0等情况。</li>
<li>硬件故障。</li>
<li>I/O设备。I/O设备启动后，一旦其准备就绪或完成一次输入/输出，便向CPU发出中断请求。</li>
<li>外部中断。如用户通过键盘来中断现行程序。</li>
</ul>
<p><font size="4" color="red">中断响应有哪些条件吗？</font><br>对于可屏蔽中断，开中断是响应中断的前提。例如，在Intel80X86 CPU上，EFLAGS寄存器的IF标志置1时表示开中断。</p>
<p><font size="4" color="red">什么时候响应中断呢？</font><br>前面我们知道，内部中断是发生在指令执行完毕之后，外部中断是发生在CPU时钟信号之后，而对于外部中断，CPU每<strong>执行完一条指令</strong>都会检测是否有外部中断信号到来。若有则转中断处理。</p>
<p><font size="4" color="red">单重外部中断的处理过程</font><br>CPU在反复执行指令的过程中，每执行完一条指令，都会去检测是否有外部中断信号到来。如果检测到有中断信号，则转中断处理过程。</p>
<ol>
<li>保护断点。把当前要执行的下一条指令的地址保存到内存中，以便中断返回时能把这个地址恢复到程序计数器PC中，使被中断的程序从断点处开始继续执行。</li>
<li>关中断，转中断处理程序，在<strong>中断处理程序中保护现场</strong>。也就是把相关的硬件上下文信息（中断返回恢复被中断程序的执行时，需要写回CPU寄存器的值）保存到内存中。</li>
<li>根据中断向量到中断向量表中找到中断例程的入口地址。</li>
<li>执行中断例程，完成本次中断处理工作。</li>
<li>恢复现场，开中断，CPU返回断点处继续执行被中断的程序。</li>
</ol>
<p><font size="4" color="red">怎么找到中断服务子例程？</font></p>
<ul>
<li>中断向量（中断类型号）<br>中断向量是对不同的中断源到来的信号编号，是一个无符号整数（0~255）。<br>不可屏蔽中断和异常的中断向量是固定的，而可屏蔽中断的向量可以通过对中断控制器编程来改变。<br>可屏蔽中断控制器的IRQ线是从0开始按顺序编号的，因此，第一条IRQ线通常表示成IRQ0。与IRQn关联的Intel缺省向量是n+32。通过向中断控制器端口发布合适的指令可以修改IRQ和向量之间的映射。</li>
<li>中断描述符表（Interrupt Descriptor Table,IDT，又叫中断向量表）<br>它是一个系统表，每一个中断或异常都在表中有唯一对应的表项，其中存有与中断或异常处理子例程入口地址相关的信息。<br>在Linux里，IDT的每个表项占8个字节（64位）。IDT表的起始地址由操作系统执行lidt汇编指令并存放在idtr CPU寄存器中。</li>
</ul>
<p>中断子例程的入口地址相关信息在内存中的地址=idtr中的起始地址 + 8 x 中断向量的值。</p>
<hr>
<p><font size="5" color="orange">时钟管理</font></p>
<p><font size="4" color="red">时钟有何用</font><br>时钟是计算机系统的脉搏，很多计算机的活动都是由定时器测量来驱动的。计算机中当前时间显示功能、即时通讯等与时间相关的软件都需要时钟机制的支持。<br>比如要编译一个很大的工程文件，不可能每次编译都去重新编译所有源文件，而是只编译修改过的那些源程序。判断方法是看a.c最后生成时间是否晚于a.obj的生成时间。</p>
<p><font size="4" color="red">计算机系统中的时钟机制</font><br>计算机系统中其实有两种时钟：RTC（Real-Time Clock）时钟和OS时钟。<br>RTC时钟也叫CMOS时钟，是一块时钟芯片，靠电池供电，为计算机提供计时标准，是最原始、最底层的时间数据。<br>OS时钟是产生于PC机主板上的定时/计数芯片，在开机时有效，由操作系统控制。<br>计算机开机加电后，操作系统通过BIOS获取当前RTC时钟的值，来作为系统的初始时间。操作系统初始化后启用自己的时钟硬件（可编程间隔定时器PIT，Programmable Interval Timer）。PIT按照一定的频率产生时钟中断，来告诉内核又一个时间间隔过去了。<br>RCT时钟和OS时钟关系如下图所示：</p>
<p><font size="4" color="red">OS时钟机制</font><br>OS系统时钟主要有两个作用：</p>
<ul>
<li>保存当前日期和时间，便于用户程序可以通过系统调用获取当前时间，同时也可以由内核把当前时间作为文件和网络包的时间戳</li>
<li>维持定时器，用来告诉内核或用户程序某一时间间隔已经过去了</li>
</ul>
<p>OS时钟依靠时钟硬件（可编程间隔定时器）和时钟软件（时钟中断处理程序）来实现。下面简单介绍一下它俩：</p>
<ul>
<li>可编程间隔定时器PIT（OS时钟硬件）<br>主要有晶振、计数器、保持寄存器三部分构成。如下图所示：<br>晶振按固定频率产生脉冲，每产生一次脉冲计数器值减1，当计数器值减到0时，产生一次时钟中断信号，再把保持寄存器的值送往计数器，使其恢复初始值。这样，PIT就每隔一定时间产生一次时钟信号了。</li>
<li>时钟中断处理程序（OS时钟软件）<br>也叫时钟驱动程序。PIT每产生一次时钟中断信号，OS内核都要执行时钟中断处理程序，来完成如下功能<ul>
<li>维护日期、时间</li>
<li>递减时间片并检查是否为0，防止进程运行超时</li>
<li>对CPU的使用情况记账</li>
<li>递减报警计数器</li>
</ul>
</li>
</ul>
<p>【注】：Linux OS时钟的时间基准是1970.1.1的凌晨0点</p>
<hr>
<p><font size="5" color="orange">系统调用</font></p>
<p><font size="4" color="red">什么是系统调用？</font><br>操作系统内核中有一些预先定义好的模块，系统调用就是让用户程序去调用这些内核模块的接口。如C语言的getpid()函数实际上是调用了在内核态运行的系统调用sysgetpid()，来获得进程标识符。可以看出，系统调用和一般函数调用还是挺像的。</p>
<p><font size="4" color="red">系统调用和一般函数调用的区别？</font><br>先来看看用户态和核心态的概念：<br>当一个进程在用户空间执行时，该进程便处在用户态；当一个进程在具有执行系统核心代码的权利时，该进程便处于核心态。<br>那么系统调用和一般函数调用的区别是什么呢？</p>
<ul>
<li>系统调用运行在核心态，一般函数运行在用户态</li>
<li>用户态进程执行系统调用时（调用前进程处于用户态，调用时进程处于核心态，调用后进程处于用户态），当前进程会被中断，由系统去找到相应的系统调用子程序，并且在核心态下执行，而一般函数调用是不需要中断处理的。</li>
</ul>
<p><font size="4" color="red">Linux中的一些系统调用</font></p>
<ul>
<li>fork：创建一个新进程</li>
<li>clone：按指定条件创建子进程</li>
<li>execve：运行可执行文件</li>
<li>exit：中止进程</li>
<li>getpgid：获取进程组标识号</li>
<li>open：打开文件</li>
<li>creat：创建新文件</li>
<li>close：关键文件描述字</li>
<li>read：读文件</li>
<li>write：写文件</li>
</ul>

            </div>

            <!-- Post Comments -->
            
    <!-- 使用 DISQUS_CLICK -->
<div id="disqus-comment">
    <div id="disqus_thread"></div>

<!-- add animation -->
<style>
	.disqus_click_btn {
            line-height: 30px;
            margin: 0;
            min-width: 50px;
            padding: 0 14px;
            display: inline-block;
            font-family: "Roboto", "Helvetica", "Arial", sans-serif;
            font-size: 14px;
            font-weight: 400;
            text-transform: uppercase;
            letter-spacing: 0;
            overflow: hidden;
            will-change: box-shadow;
            transition: box-shadow .2s cubic-bezier(.4, 0, 1, 1), background-color .2s cubic-bezier(.4, 0, .2, 1), color .2s cubic-bezier(.4, 0, .2, 1);
            outline: 0;
            cursor: pointer;
            text-decoration: none;
            text-align: center;
            vertical-align: middle;
            border: 0;
            background: rgba(158, 158, 158, .2);
            box-shadow: 0 2px 2px 0 rgba(0, 0, 0, .14), 0 3px 1px -2px rgba(0, 0, 0, .2), 0 1px 5px 0 rgba(0, 0, 0, .12);
            color: #fff;
            background-color: #7EC0EE;
            text-shadow: 0
        }
</style>
	
<div class="btn_click_load" id="disqus_bt"> 
    <button class="disqus_click_btn">点击查看评论</button>
</div>

<!--
<script type="text/javascript">
$('.btn_click_load').click(function() {
    /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
    var disqus_shortname = 'http-miccall-tech'; // required: replace example with your forum shortname

    /* * * DON'T EDIT BELOW THIS LINE * * */
    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();

    document.getElementById('disqus_bt').style.display = "none";
});
</script>
-->
<script type="text/javascript">
    var disqus_config = function () {
        this.page.url = 'http://yoursite.com/2016/10/14/操作系统内核/';  // Replace PAGE_URL with your page's canonical URL variable
        this.page.identifier = 'http://yoursite.com/2016/10/14/操作系统内核/'; // Replace PAGE_IDENTIFIER with your page's unique identifier variable
    };
</script>

<script type="text/javascript">
    $('.btn_click_load').click(function() {  //click to load comments
        (function() { // DON'T EDIT BELOW THIS LINE
            var d = document;
            var s = d.createElement('script');
            s.src = '//http-miccall-tech.disqus.com/embed.js';
            s.setAttribute('data-timestamp', + new Date());
            (d.head || d.body).appendChild(s);
        })();
        $('.btn_click_load').css('display','none');
    });
</script>
</div>
<style>
    #disqus-comment{
        background-color: #eee;
        padding: 2pc;
    }
</style>


        </div>
        <!-- Copyright 版权 start -->
                <div id="copyright">
            <ul>
                <li>&copy;Powered By <a href="https://hexo.io/zh-cn/" style="border-bottom: none;">hexo</a></li>
                <li>Design: <a href="http://miccall.tech " style="border-bottom: none;">miccall</a></li>
            </ul>
            
            	<span id="busuanzi_container_site_pv">2018总访问量<span id="busuanzi_value_site_pv"></span>次</span>
			
        </div>
    </div>
</body>



 	
</html>
